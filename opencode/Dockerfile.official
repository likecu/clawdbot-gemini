FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    curl \
    nodejs \
    npm \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

RUN curl -fsSL https://opencode.ai/install | bash

WORKDIR /workspace

ENV GEMINI_API_KEY=${GEMINI_API_KEY:-""}

RUN echo '#!/bin/bash\n\
echo "{\"\\$schema\": \"https://opencode.ai/config.json\", \"provider\": { "gemini": { "npm\": \"@ai-sdk/openai-compatible\", \"name\": \"gemini\", \"options\": { \"baseURL\": \"https://generativelanguage.googleapis.com/v1beta/openai/\", \"apiKey\": \"'${GEMINI_API_KEY}'\", \"models\": { \"gemini-1.5-pro\": { \"name\": \"gemini-1.5-pro\" }, \"gemini-1.5-flash\": { \"name\": \"gemini-1.5-flash\" } } } } }" > /workspace/opencode.json\n\
cat /workspace/opencode.json\n' > /workspace/configure_gemini.sh && chmod +x /workspace/configure_gemini.sh

EXPOSE 8080

CMD ["/bin/bash"]
